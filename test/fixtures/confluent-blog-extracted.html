<div id="readability-page-1" class="page"><div data-swiftype-name="body" data-swiftype-type="text"><h2><b>Consumer Groups and the Rebalance Protocol</b></h2><p>The consumer group is a cornerstone of Apache Kafka®, enabling scalable and fault-tolerant data consumption by allowing multiple consumer instances to share the workload of reading from topic partitions. The consumer rebalance protocol is the mechanism that coordinates which partitions are assigned to which consumers within a group.</p><!--$--><!--/$--><p>Historically, Kafka has relied on what we now call the "classic" rebalance protocol. This protocol evolved, as it was initially dominated by the "eager" assignment strategy. Eager rebalancing worked on a stop-the-world principle: Any change in group membership (consumer joining/leaving) or topic metadata triggered a complete halt. All consumers revoked their partitions, a leader computed a new assignment, and partitions were redistributed before processing could resume. This caused significant downtime, especially in dynamic environments.</p><!--$--><!--/$--><p>To mitigate this, the <a href="https://www.confluent.io/en-gb/blog/cooperative-rebalancing-in-kafka-streams-consumer-ksqldb/">cooperative</a> assignment strategy was introduced within the classic protocol. Cooperative rebalancing reduced downtime by allowing consumers to keep partitions unaffected by the rebalance, revoking only those needing reassignment. While an improvement, the classic protocol, even with cooperative assignment, still relied on a group-wide synchronization barrier and client-driven logic. Rebalances could involve multiple communication rounds, introduce delays, and increase operational complexity, particularly for large groups with many partitions. These delays and complexities became significant pain points for applications demanding high availability and low latency.</p><!--$--><!--/$--><p>Addressing these challenges head-on, KIP-848 introduces a fundamentally new, optional <b>consumer rebalance protocol</b>, built on lessons learned and designed for modern, large-scale stream processing.</p><p>Available in Apache Kafka 4.0, Confluent Cloud, and Confluent Platform 8.0, the KIP-848 protocol redesigns the consumer-broker interaction for rebalancing. KIP-848, with its core innovations, is a truly incremental/async protocol that shifts coordination logic from the client to the broker-side <b>group coordinator</b>.</p><h3><b>Summary of Key Differences</b></h3><p>The key processing differences between classic and consumer is summarized below.</p><table><tbody><tr><th></th><th><p>Classic - Eager</p></th><th><p>Classic - Cooperative</p></th><th><p>Consumer</p></th></tr><tr><td><p>Application Impact</p></td><td><p>Full stop-the-world events occur</p></td><td><p>Partial stop-the-world 
consumer lag builds because commit cannot progress</p></td><td><p>No stop–the-world pause</p><p>No impact to consumers&nbsp; with partitions not included in shuffling</p></td></tr><tr><td><p>Fetch Processing</p></td><td><p>Paused during rebalance processing</p></td><td><p>Able to progress during rebalance processing </p></td><td><p>Able to progress during rebalance processing</p></td></tr><tr><td><p>Commit Processing</p></td><td><p>Paused during rebalance processing</p></td><td><p>Paused during rebalance processing</p></td><td><p>Able to progress during rebalance processing </p></td></tr><tr><td><p>Consumer Impact</p></td><td><p>All consumers in a group are impacted</p></td><td><p>All consumers in a group are impacted</p></td><td><p>Select consumers in a group are impacted</p></td></tr></tbody></table><h3><b>How It Works: Server-Driven Reconciliation</b></h3><p>Instead of clients coordinating through multiple JoinGroup/SyncGroup phases, the new protocol uses a continuous <b>heartbeat</b> mechanism and a server-driven <b>reconciliation process</b>.</p><ol><li><p><b>Declarative state:</b> Consumers declare their subscriptions and acknowledge partition assignments/revocations via the heartbeat mechanism. They don't compute assignments themselves (unless using the extended protocol).</p></li><li><p><b>Coordinator orchestration:</b> The group coordinator becomes the central intelligence. It maintains group membership, monitors topic metadata (including handling wildcard subscriptions), computes the target assignment using a server-side assignor (pluggable, with range and uniform assignors provided by default), and orchestrates the transition toward this target state.</p></li><li><p><b>Incremental reconciliation:</b> The coordinator drives rebalances incrementally. It compares the current state (partitions owned by each consumer) with the target assignment. It then issues specific revoke/assign commands to individual consumers via the heartbeat response.</p></li><li><p><b>No global synchronization:</b> Crucially, there's no group-wide stop-the-world pause. A consumer pauses processing only for the specific partitions it's asked to revoke. Other consumers continue processing unaffected partitions. The coordinator manages dependencies, ensuring that a partition is fully revoked by one consumer before being assigned to another. Consumers move through assignment “epochs” independently as they complete revocations.</p></li><li><p><b>Server-side configuration:</b> Key parameters such as session timeout (<code>group.consumer.session.timeout.ms</code>) and heartbeat interval (<code>group.consumer.heartbeat.interval.ms</code>) are now configured on the server dynamically per group, simplifying client setup. The client provides a <code>rebalance.timeout.ms</code> (based on <code>max.poll.interval.ms</code>) indicating how long it needs to revoke partitions and an optional group.remote.assignor to specify the server-side assigner to use.</p></li></ol><!--$--><!--/$--><h2><b>Key Benefits of KIP-848</b></h2><ul><li><p><b>Reduced/eliminated consumer downtime:</b> Incremental changes minimize the stop-the-world effect, often eliminating pauses entirely for consumers keeping processing online.</p></li><li><p><b>Faster rebalances:</b> Server-driven, incremental changes are significantly faster than the classic protocol. Multi-threaded processing on the broker further parallelizes large group rebalances.</p></li><li><p><b>Improved stability and scalability:</b> The protocol is more resilient, and shifting complexity to the server makes clients lighter and easier to implement and manage. Broker-driven logic scales better with large numbers of partitions and consumers.</p></li><li><p><b>Simplified management:</b> Centralized, server-side configuration streamlines setup.</p></li><li><p><b>Enhanced monitoring:</b> New metrics provide better visibility into rebalance performance in tools such as Confluent Control Center and the Confluent Cloud user interface.</p></li><li><p><b>Foundation for future enhancements:</b> KIP-848 supports existing assignors with performance improvements and the ability to extend the new server-side assignor implementation, and it paves the way for extensions of the protocol, such as KIP-1071, the Kafka Streams rebalance protocol. Note: Rack-aware strategies are not yet supported (see KAFKA-17747).</p></li></ul><h2><b>Adopting the New Protocol: An Easy Upgrade</b></h2><p>Upgrading to the new consumer rebalance protocol is straightforward:</p><ol><li><p><b>Ensure cluster support:</b> Your cluster must run Apache Kafka 4.0+ or Confluent Platform 8.0+ or must be on Confluent Cloud.</p></li><li><p><b>Upgrade clients:</b> Update your consumer applications to use Kafka client libraries that are compatible with the new protocol (e.g., Java clients for Apache Kafka 4.0+). Note: For librdkafka-based clients, KIP-848 is in Early Access with <!-- -->librdkafka<!-- --> 2.10.</p></li><li><p><b>Configure consumers:</b> Set the consumer configuration <code>group.protocol=consumer</code>.&nbsp;</p></li><li><p><b>Migrate consumer configs: </b>Migrate consumer configs to remove unsupported properties now moved to the broker (partition.assignment.strategy, <a href="http://session.timeout.ms/">session.timeout.ms</a>, and <a href="http://heartbeat.interval.ms/">heartbeat.interval.ms</a>).</p></li></ol><p>The protocol supports <b>live upgrades </b>or<b> offline upgrades</b>. Live upgrades can be performed via a rolling restart of consumer instances. When the first consumer configured with <code>group.protocol=consumer</code> joins an existing classic group, the group coordinator automatically transitions the group. It internally proxies the classic protocol (join/sync/heartbeat) requests from older clients to work seamlessly alongside the new protocol messages from upgraded clients. This is possible if the classic group uses a standard assignor without custom metadata. (Note: Mixing consumer rebalance protocols in the same consumer group is intended only for temporary scenarios to support live upgrades.)&nbsp;</p><h2><b>What's Next?</b></h2><p>The new consumer rebalance protocol is Generally Available in Apache Kafka, Confluent Cloud and (soon) Confluent Platform 8.0. KIP-848 is also in Early Access in <a href="https://github.com/confluentinc/librdkafka">librdkafka</a>-based clients with <!-- -->librdkafka<!-- --> 2.10. Future enhancements include client-side performance improvements and full topic ID support when retrieving and committing offsets. Work is also underway to bring these benefits to Kafka Streams via KIP-1071. Kafka Connect and Schema Registry are also expected to adopt this protocol as the default in the future.</p><p>Given the substantial benefits it provides, the new KIP-848 protocol will become the default rebalance protocol in a future Apache Kafka release, likely version 5.0.</p><h2><b>Conclusion</b></h2><p>The KIP-848 consumer rebalance protocol represents a significant leap forward for Apache Kafka, as it addresses key limitations of the classic protocol. By shifting coordination to the broker and enabling incremental, server-driven reconciliation, it delivers faster rebalances and more stable and scalable groups. This enhancement reduces operational overhead and improves the availability and performance of Kafka applications.&nbsp;</p><p>We encourage you to try the new protocol in your development environments on Confluent Cloud or compatible platforms and <a href="mailto:jlacefield@confluent.io">share your feedback</a>!</p><!--$--><p>‎&nbsp;</p><!--/$--><p><i>Apache</i><i>®</i><i>, Apache Kafka</i><i>®</i><i>, and Kafka</i><i>®</i><i> are registered trademarks of the Apache Software Foundation in the United States and/or other countries. No endorsement by the Apache Software Foundation is implied by using these marks. All other trademarks are the property of their respective owners.</i></p></div></div>